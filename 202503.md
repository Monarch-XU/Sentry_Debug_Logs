# 2025 年3月调试日志

## 2025/3/3  Error

关键词：导航、裁判系统、yaw

总结一下最近的问题、解决方法以及注意事项；

导航方向偏移情况：检查里程计信息。由于激光雷达是倒置的，因此激光里程计在y轴方向和实际是相反的；

裁判系统测速模块不停亮绿灯自检：其多出来的一根航空线接触到了导体导数电流过大，出现了冒烟的情况。检查发现测速模块裸露的航空线发热严重，认为是线芯接触导体导致电流过大发热。之后要用电工胶将多余的线头包起来。

上下位机通信：下位机注意字节数的检查，很多次发现通信的字节数是不一致的

云台yaw轴漂移：哨兵左云台的漂移严重，yaw角两秒就能漂一度。这样在大yaw决定以及敌方位置标定上会有问题。建议升级imu


## 2025/3/10  Error

关键词：重定位、串口、云台、自瞄

最近交流赛出现了以下问题：

云台调度失误导致小云台限位卡死：在云台锁到侧后方目标时大yaw迅速转动，带动另一个云台快速转动（摆动），摆动过快来不及停止导致直接撞上限位直接卡死。解决方式是上位机的大yaw控制节点上了一个单次最大转动角度的限制，小于限制就按照正常的数值转动，大于限制就只按照最大允许角度转动。

重定位的鲁棒性不够，在赛场上不能发挥作用：重定位使用的先验点云用的是官方的stp格式地图导出，但是在实验室测试时发现实际扫描的点云和官方场地差距较大（实际中扫描会透过场地网状围栏把场外的地形扫描进去，与模型点云形成较大差异）。还有个原因就是由于雷达倒置，扫描地图点云的高度很有限，而官方地图导出的点云在垂直方向上有一定高度。因此在实验室试验中我取消了精匹配环节，只用粗匹配，效果有了一定提升。但是在实战测试中（凌晨在交流赛场地实测）还是有较大的偏差（在实验室测的粗匹配分数大约是2-3，但在交流赛场地的匹配分数是15-17），原因还是扫描会透过场地网状围栏扫描赛场外地形。因此最后还是选择使用固定里程计的方法。现在需要一种能扫描到场地围栏的方法，这在理论上是可以实现的。港科实验室无人机上的mid360能够识别到直径2.5mm的细线并避障，我觉得应该是有什么参数没调对。https://www.bilibili.com/video/BV1BSFgeJEJn/?spm_id_from=333.337.search-card.all.click&vd_source=475529e9fb4f4add21d01e33d33593ca

好吧，经过实测mid360只能扫描到1cm宽的软皮尺，而不能扫描到直径1mm细的网状围栏。所以现在的思路是只识别距离地面高度50cm以下的点云（官方地图里面有50cm高的实心地基，可以反射激光），使用点云分割实现。

曝光参数不对导致自瞄误识别：海康相机的参数没改。因为现在双头的自瞄集成到了一台电脑上，为了能分别调试两个云台的参数（尤其是偏置），我将原先的robot_detection自瞄包分成了robot_detection_l和robot_detection_r两个包，我将其中的参数加载路径诸如std::string package_path = ros::package::getPath("robot_detection")的加载行为都改成了std::string package_path = ros::package::getPath("robot_detection_l")（右云台同理），这样就能给两个云台加载不同的参数。但是我忘记改hik_camera里面的参数了，也没给海康分成两个包，就使得关于相机曝光的参数实际上是没有改过的（我只改了robot_detection_l和robot_detection_r里面的曝光参数，但实际hik里读的是robot_detection包里的参数）。这使得赛场上误识别的产生。这点今后注意。

追击距离有误：在测算敌人距离并追击的时候测距有误，导致追击距离过大直接干到别人补给区里了。

读不到裁判系统数据，疑似串口没改。改完就能运行了。


## 2025/3/13  Error

关键词：大yaw

哨兵在启动后的某些时候大yaw会抽搐。发现是行为树在游戏没开始的时候会一直发送以当前位姿为目标的航点（目的是停止车辆移动），这会导致误差累积。于是调整了一下，游戏未开始的时候还是发送当前位姿为目标航点，不过z轴坐标改成了z=-100，这样会停止对大yaw的控制（这是我自己规定的协议）

